================================================================================
PROJECT BLUEPRINT
================================================================================

MASTER PROJECT SUMMARY
--------------------------------------------------------------------------------
MASTER SUMMARY

1) PROJECT OVERVIEW
- What is this project? A Node.js/Express-based web application that provides a basic user authentication system with a MongoDB backend. It includes signup with email verification, login/logout, password reset, and a simple client UI (landing page, dashboard, and reset flows).
- Main purpose: To offer a straightforward, session-based authentication flow with email verification and password recovery, along with a minimal dashboard protected by user sessions. It also includes a utility to log page visits by client IP.

2) KEY FEATURES
- User signup with email verification: Creates a user with a hashed password and generates an email verification token; sends a verification email to activate the account.
- Email-based password reset: Generates a reset token when requested and emails a reset link to the user; allows the user to set a new password via the reset form.
- Session-based authentication: Uses server-side sessions to protect a dashboard page; authenticated users can access the dashboard, while unauthenticated requests are redirected to the home page.
- Dashboard access: A simple dashboard (dash.html) that displays user information (e.g., email) and provides a Log Out option.
- Client UI for auth flows: Landing page with signup/login forms, password reset flow, and client-side logic to render and validate forms and perform AJAX requests.
- Email delivery: SMTP-based email sending for verification and password reset via Nodemailer (configured with environment-stored credentials).
- IP-based visit logging: checkip.js logs page visits by client IP into MongoDB (per-IP documents with a visits array, timestamps in America/Phoenix).
- Documentation and tooling: A Python script (makegen.py) to generate a documentation doc containing the project structure and file contents for quick reference.

3) ARCHITECTURE
- Server
  - Express-based Node.js application (app.js) handling routing for signup, login, logout, user data, email verification, and password reset.
  - Middleware and configuration for CORS, body parsing, and session management.
  - Uses MongoDB as the data store (mtcdata database) via mongologin.js to manage users and tokens.
- Database
  - MongoDB database named mtcdata.
  - Collections likely include: users (with hashed passwords, verification tokens, reset tokens, and verification status) and visited_pages (for IP visit logging via checkip.js).
- Email subsystem
  - email.js sets up a Nodemailer SMTP transporter (mail.privateemail.com) and provides a function to send HTML emails for verification and password reset.
- Client/UI
  - client/ folder contains:
    - index.html: Landing page with signup/login forms and navigation.
    - dash.html: Protected dashboard that fetches current user data via /user and supports logout.
    - reset-password.html: Password reset form.
    - CSS (css/main.css) and fonts for the UI.
    - JavaScript (js/main.js) to manage frontend auth UI, form validation, and AJAX calls to /signup, /login, /user, /request-password-reset, and /reset-password.
- Utilities
  - checkip.js: Logs visits by client IP; upserts per-IP entries and appends visits with timestamp (America/Phoenix) and page name.
  - makegen.py: Generates a Markdown document that documents the project structure and inlines file contents for chosen files.
  - info.txt, project_goals/*, status.md: Documentation and project meta/assets.
- Deployment/runtime
  - Requires Node.js runtime, MongoDB instance, and SMTP credentials.
  - Environment variables used for sensitive data (e.g., database connection, SMTP credentials, session secret).

4) HOW IT WORKS (WORKFLOW & KEY PROCESSES)
- Sign Up
  - User fills signup form on the client UI.
  - Client sends POST to /signup with email and password.
  - Server hashes the password, creates a user with a verification token, and stores it in MongoDB.
  - Server sends a verification email via email.js containing a link with the token.
  - User clicks the link to verify the email; server validates the token and activates the account.
- Log In
  - User submits login form on the client.
  - Client sends POST to /login with credentials.
  - Server validates the password; if valid and the account is verified, a server-side session is created.
  - Access to the dashboard (dash.html) is allowed; unauthorized attempts redirect to the home page.
- User Data & Dashboard
  - Authenticated requests to /user return the current user’s information (e.g., email).
  - dash.html displays user details and provides a Log Out button that POSTs to /logout, ending the session and returning to home.
- Password Reset
  - User requests a reset via the UI; client sends POST to /request-password-reset with their email.
  - Server generates a reset token, stores it, and emails a reset link to the user.
  - User clicks the reset link (carrying the token) and uses reset-password.html to submit a new password via POST to /reset-password.
  - Server validates the token, updates the password (hashing it), and invalidates the token; user is prompted to log in.
- IP Visit Tracking
  - On page visits, checkip.js logs the IP address, creates or updates a per-IP document, and appends visit records with the page name and timestamp in America/Phoenix.
- Frontend-Backend Interaction
  - The frontend uses AJAX to endpoints: /signup, /login, /user, /request-password-reset, and /reset-password; on success, redirects (e.g., to the dashboard) or shows messages.
- Static UI Serving
  - app.js serves the static client UI from the client/ directory, enabling the landing page, signup/login forms, and dashboard.

5) TECHNOLOGIES
- Backend / Frameworks
  - Node.js
  - Express.js (server framework)
  - MongoDB (mtcdata)
  - MongoDB native driver (via mongologin.js) for user management and tokens
  - Nodemailer (email sending via SMTP)
- Frontend / UI
  - HTML/CSS/JavaScript
  - jQuery and Bootstrap referenced in the landing page (client/index.html)
  - Client-side logic in client/js/main.js to drive authentication UI and AJAX calls
- Utilities
  - checkip.js for IP-based analytics
  - makegen.py for document generation
- Documentation / Meta
  - README.md, status.md, info.txt, project_goals/
  - Fonts and CSS assets under client/
  - A README describes prerequisites, run steps, and project structure
- Other notes
  - The package.json and package-lock.json indicate dependency management with Express, authentication, and related tooling.
  - environment-specific credentials (SMTP, database) are intended to be supplied via environment variables.

Additional notes and context
- The repository includes a status.md that provides an assessment of security strengths and identified vulnerabilities with recommended fixes, signaling that there are known weaknesses to address for production readiness (e.g., hardening session management, input validation, CSRF protection, TLS considerations, and proper token expiration handling).
- The project is structured to be runnable locally with a MongoDB instance and SMTP credentials, and it includes a lightweight frontend for testing the authentication flow.

If you’d like, I can tailor this master summary into a single-page README draft or create a concise architectural diagram description to accompany the summary.


================================================================================
FILE TREE STRUCTURE
================================================================================

NodeJs_login_template/
 client/
    css/
       main.css
    Fonts/
       verah.ttf
       verahb.ttf
       verahbi_.ttf
       verahi__.ttf
    js/
       main.js
    dash.html
    index.html
    reset-password.html
 project_goals/
    changelog.txt
    goal.txt
    goals.txt
 .gitignore
 app.js
 checkip.js
 email.js
 info.txt
 makegen.py
 mongologin.js
 package-lock.json
 package.json
 README.md
 status.md


================================================================================
FILE DESCRIPTIONS
================================================================================

.gitignore
  Description: This is a Git ignore configuration (.gitignore) for a Node.js project, listing files and directories to exclude from version control (e.g., logs, node_modules, build outputs, caches, environment files, and various tool/framework artifacts).

README.md
  Description: This README documents a Node.js/Express-based basic login system built with MongoDB, describing its features and how to run it. It covers signup, login, email verification, password reset, session management, prerequisites, installation steps, environment setup, and the project structure.

app.js
  Description: A Node.js Express server that handles user authentication flows (signup with email verification, login/logout, and password reset), uses session-based authentication to protect a dashboard, serves a static client UI, and interfaces with MongoDB for user data and email confirmations. It also configures CORS, body parsing, and email sending.

checkip.js
  Description: This module exports a function checkip that logs a page visit by a client IP into MongoDB. It upserts a per-IP document in the mtcdata.visited_pages collection and appends each visit (timestamp in America/Phoenix and pageName) to a visits array.

client\Fonts\verah.ttf
  Description: Font file.

client\Fonts\verahb.ttf
  Description: Font file.

client\Fonts\verahbi_.ttf
  Description: Font file.

client\Fonts\verahi__.ttf
  Description: Font file.

client\css\main.css
  Description: This CSS stylesheet defines the layout and styling for the login template’s client-side UI—centering the main form, constraining widths, styling the navigation bar and links, centering images, and hiding the element with id #form1 by default.

client\dash.html
  Description: HTML dashboard page that uses jQuery to fetch the current user from /user and display their email, redirecting to home on error, with a Log Out button that POSTs to /logout and then redirects home.

client\index.html
  Description: This HTML file renders a landing page with a user signup form (email, password, repeat password, remember me) and a simple navigation (Sign up, Log in, About), pulling in Bootstrap, jQuery, and custom CSS/JS.

client\js\main.js
  Description: Manages the client-side authentication UI (login, sign-up, and password reset) by rendering/toggling forms and validating input. It also makes AJAX requests to /signup, /login, /user, and /request-password-reset, handling responses and redirecting to the dashboard when appropriate.

client\reset-password.html
  Description: This is an HTML page for resetting a user's password. It renders a form to enter a new password and confirm it, sends the token from the URL together with the new password to /reset-password via AJAX, and displays success/error messages (redirecting to login on success).

email.js
  Description: Sets up a Nodemailer SMTP transporter using environment-stored credentials and exports a function to send HTML confirmation emails via mail.privateemail.com, handling success and errors.

info.txt
  Description: This file stores basic metadata about the repository NodeJs_login_template, including its name, description, and creation date.

makegen.py
  Description: Generates a Markdown document (program_structure.md) that lists an ASCII tree of specified project files relative to the script's directory and appends the contents of those files into the same document. It effectively creates a structured overview plus inline file contents for the listed files.

mongologin.js
  Description: This file provides MongoDB-backed user management utilities: it connects to the mtcdata database, creates users with hashed passwords and email verification tokens, and supports email verification, user lookup (by email or token), and password reset token handling/updating. It exports functions for hashing/validating passwords, saving reset tokens, and updating passwords.

package-lock.json
  Description: Dependency lock file - ensures consistent package versions.

package.json
  Description: This is the Node.js package.json for the project, serving as its manifest with metadata, the main entry point (index.js), and a list of dependencies (Express, databases, Alpaca API, authentication, etc.). It also includes a placeholder test script.

project_goals\changelog.txt
  Description: This is a changelog file that records update events related to "Shuffle." It currently contains four identical entries labeled "Shuffle_UPDATE" dated 2024-06-23.

project_goals\goal.txt
  Description: This is a simple to-do note (goal.txt) listing the task "Add in socket connection" for the project. It doesn't implement the functionality itself; it just records the goal.

project_goals\goals.txt
  Description: This is a goals.txt log file that currently contains a single entry: “UPDATE - File created.” It acts as a minimal log/marker indicating that the goals file was created.

status.md
  Description: This status.md is a comprehensive assessment of a Node.js login template, highlighting strengths in security, code architecture, and user experience while identifying critical vulnerabilities and recommended fixes. It also provides quick fixes, long-term improvements, and deployment considerations.
